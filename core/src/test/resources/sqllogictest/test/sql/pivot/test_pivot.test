statement ok
CREATE TABLE Cities(Country VARCHAR, Name VARCHAR, Year INT, Population INT);

statement ok
INSERT INTO Cities VALUES ('NL', 'Amsterdam', 2000, 1005);

statement ok
INSERT INTO Cities VALUES ('NL', 'Amsterdam', 2010, 1065);

statement ok
INSERT INTO Cities VALUES ('NL', 'Amsterdam', 2020, 1158);

statement ok
INSERT INTO Cities VALUES ('US', 'Seattle', 2000, 564);

statement ok
INSERT INTO Cities VALUES ('US', 'Seattle', 2010, 608);

statement ok
INSERT INTO Cities VALUES ('US', 'Seattle', 2020, 738);

statement ok
INSERT INTO Cities VALUES ('US', 'New York City', 2000, 8015);

statement ok
INSERT INTO Cities VALUES ('US', 'New York City', 2010, 8175);

statement ok
INSERT INTO Cities VALUES ('US', 'New York City', 2020, 8772);

query IIII rowsort
Cities PIVOT (SUM(Population) FOR year IN (2000, 2010, 2020) GROUP BY Country);
----
NL 1005 1065 1158
US 8579 8783 9510

query IIII rowsort
Cities PIVOT (SUM(1) FOR year IN (2000, 2010, 2020) GROUP BY Country);
----
NL	1	1	1
US	2	2	2

query IIII rowsort
Cities PIVOT (SUM(1) FOR year IN (2000, 2010, 2020) GROUP BY Country, Year);
----
NL 2000 1 NULL NULL
NL 2010 NULL 1 NULL
NL 2020 NULL NULL 1
US 2000 2 NULL NULL
US 2010 NULL 2 NULL
US 2020 NULL NULL 2

query II rowsort
SELECT DISTINCT country, year FROM Cities;
----
NL 2000
NL 2010
NL 2020
US 2000
US 2010
US 2020


statement ok
CREATE TABLE Produce AS (
  SELECT 'Kale' as product, 51 as sales, 'Q1' as quarter, 2020 as year UNION ALL
  SELECT 'Kale', 23, 'Q2', 2020 UNION ALL
  SELECT 'Kale', 45, 'Q3', 2020 UNION ALL
  SELECT 'Kale', 3, 'Q4', 2020 UNION ALL
  SELECT 'Kale', 70, 'Q1', 2021 UNION ALL
  SELECT 'Kale', 85, 'Q2', 2021 UNION ALL
  SELECT 'Apple', 77, 'Q1', 2020 UNION ALL
  SELECT 'Apple', 0, 'Q2', 2020 UNION ALL
  SELECT 'Apple', 1, 'Q1', 2021
)

query IIIIII
Produce
PIVOT(SUM(sales) FOR quarter IN ('Q1', 'Q2', 'Q3', 'Q4'))
GROUP BY product, year
ORDER BY product, year;
----
Apple	2020	77	0	NULL	NULL
Apple	2021	1	NULL	NULL	NULL
Kale	2020	51	23	45	3
Kale	2021	70	85	NULL	NULL

query IIIII
(SELECT product, sales, quarter FROM Produce)
PIVOT(SUM(sales) FOR quarter IN ('Q1', 'Q2', 'Q3', 'Q4') GROUP BY product ORDER BY product);
----
Apple	78	0	NULL	NULL
Kale	121	108	45	3

query IIII
(SELECT product, sales, quarter FROM Produce)
PIVOT(SUM(sales) FOR quarter IN ('Q1', 'Q2', 'Q3') GROUP BY product ORDER BY product);
----
Apple	78	0	NULL
Kale	121	108	45

query III
(SELECT sales, quarter FROM Produce)
PIVOT(SUM(sales) FOR quarter IN ('Q1', 'Q2', 'Q3'))
----
199	108	45

query IIIII
(SELECT product, sales, quarter FROM Produce)
PIVOT(SUM(sales) as total_sales, COUNT(*) as num_records FOR quarter IN ('Q1', 'Q2')
GROUP BY product
ORDER BY product);
----
Apple 78 2 0 1
Kale 121 2 108 2

statement ok
DROP TABLE Produce;

statement ok
CREATE TABLE Produce AS (
  SELECT 'Kale' as product, 51 as Q1, 23 as Q2, 45 as Q3, 3 as Q4 UNION ALL
  SELECT 'Apple', 77, 0, 25, 2
);

#query III
#SELECT * FROM
#(
#Produce
#UNPIVOT(sales FOR quarter IN ('Q1', 'Q2', 'Q3', 'Q4'))
#)
#ORDER BY product;
#----
#Apple	Q1	77
#Apple	Q2	0
#Apple	Q3	25
#Apple	Q4	2
#Kale	Q1	51
#Kale	Q2	23
#Kale	Q3	45
#Kale	Q4	3
