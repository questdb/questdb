openapi: 3.0.3
info:
  title: QuestDB API v1
  description: |
    QuestDB API v1 provides RESTful endpoints for file import and export operations.

    The API v1 endpoints support authentication via standard HTTP mechanisms.
  version: 1.0.0
  contact:
    name: QuestDB
    url: https://questdb.io
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: http://localhost:9000/api/v1
    description: Default local development server
  - url: https://localhost:9000/api/v1
    description: Default local development server (HTTPS)
  - url: /api/v1
    description: Relative path

tags:
  - name: Imports
    description: File import operations - manage files in the imports directory
  - name: Exports
    description: File export operations - manage files in the exports directory

paths:
  /imports:
    get:
      tags:
        - Imports
      summary: List import files
      description: |
        Lists all files and directories in the imports root directory.

        Supports cursor-based pagination following JSON:API specification.

        Requires: sql.copy.input.root must be configured
      operationId: getImportsList
      parameters:
        - name: page[cursor]
          in: query
          description: Cursor value from a previous response to fetch the next page. Use the cursor value from meta.page.cursor
          schema:
            type: string
          example: data.parquet
        - name: page[limit]
          in: query
          description: Number of files to return per page (default 10, max 1000)
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 10
          example: 20
      responses:
        '200':
          description: Successful retrieval of import files list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileListResponse'
              examples:
                success:
                  value:
                    data:
                      - type: file
                        id: data.parquet
                        attributes:
                          filename: data.parquet
                          path: data.parquet
                          size: 2048
                          sizePretty: "2.0 KiB"
                          lastModified: 1699812345000
                    meta:
                      totalFiles: 1
                      page:
                        limit: 10
                        cursor: data.parquet
        '400':
          description: Bad request - imports path not configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
        - Imports
      summary: Upload files
      description: |
        Upload one or more files to the imports directory via multipart form data.

        Requires: sql.copy.input.root must be configured
      operationId: uploadImports
      parameters:
        - name: overwrite
          in: query
          description: Whether to overwrite existing files (default false)
          schema:
            type: boolean
            default: false
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: File(s) to upload
              required:
                - file
            encoding:
              file:
                contentType: application/octet-stream
      responses:
        '201':
          description: All files uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileUploadResponse'
              examples:
                success:
                  value:
                    data:
                      - type: file
                        id: data.parquet
                        attributes:
                          filename: data.parquet
                          status: uploaded
                    meta:
                      totalFiles: 1
        '200':
          description: Files were uploaded successfully and overwrote existing files.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileUploadResponse'
              examples:
                success:
                  value:
                    data:
                      - type: file
                        id: data.parquet
                        attributes:
                          filename: data.parquet
                          status: uploaded
                    meta:
                      totalFiles: 1
        '207':
          description: Partial success - some files uploaded, others failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileUploadResponse'
        '400':
          description: Bad request - missing filename or root not configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - path traversal attempt detected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Conflict - file exists and overwrite disabled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Unprocessable Entity - invalid file format (e.g., invalid Parquet)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /imports/{filename}:
    get:
      tags:
        - Imports
      summary: Download import file
      description: |
        Downloads a specific file from the imports directory.

        The Content-Type is determined automatically based on file extension:
        - .parquet → application/vnd.apache.parquet
        - .csv → text/csv
        - .json → application/json
        - .txt → text/plain
        - others → application/octet-stream
      operationId: downloadImport
      parameters:
        - name: filename
          in: path
          required: true
          description: Name of the file to download (can include subdirectory paths)
          schema:
            type: string
          examples:
            simple:
              value: data.parquet
            nested:
              value: subdir/data.csv
      responses:
        '200':
          description: File downloaded successfully
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
            text/csv:
              schema:
                type: string
                format: binary
            application/json:
              schema:
                type: string
                format: binary
            text/plain:
              schema:
                type: string
                format: binary
          headers:
            Content-Disposition:
              description: Suggests filename for download
              schema:
                type: string
              example: 'attachment; filename="data.parquet"'
            Content-Type:
              description: MIME type of the file
              schema:
                type: string
              example: application/octet-stream
        '400':
          description: Bad request - root not configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - path traversal attempt detected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Imports
      summary: Delete import file or directory
      description: |
        Deletes a file or directory from the imports directory.

        If the target is a directory, it will be recursively deleted.
      operationId: deleteImport
      parameters:
        - name: filename
          in: path
          required: true
          description: Name of the file or directory to delete
          schema:
            type: string
      responses:
        '200':
          description: File or directory deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteResponse'
              example:
                message: "file(s) deleted successfully"
                path: "data.parquet"
        '400':
          description: Bad request - root not configured or filename missing
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - path traversal attempt detected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error (e.g., permission denied, directory not empty)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /exports:
    get:
      tags:
        - Exports
      summary: List export files
      description: |
        Lists all files and directories in the exports root directory.

        Supports cursor-based pagination following JSON:API specification.

        Requires: sql.copy.export.root must be configured
      operationId: getExportsList
      parameters:
        - name: page[cursor]
          in: query
          description: Cursor value from a previous response to fetch the next page. Use the cursor value from meta.page.cursor
          schema:
            type: string
          example: results.csv
        - name: page[limit]
          in: query
          description: Number of files to return per page (default 10, max 1000)
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 10
          example: 20
      responses:
        '200':
          description: Successful retrieval of export files list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileListResponse'
              examples:
                success:
                  value:
                    data:
                      - type: file
                        id: results.csv
                        attributes:
                          filename: results.csv
                          path: results.csv
                          size: 4096
                          sizePretty: "4.0 KiB"
                          lastModified: 1699812345000
                    meta:
                      totalFiles: 1
                      page:
                        limit: 10
                        cursor: results.csv
        '400':
          description: Bad request - exports path not configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /exports/{filename}:
    get:
      tags:
        - Exports
      summary: Download export file
      description: |
        Downloads a specific file from the exports directory.

        The Content-Type is determined automatically based on file extension:
        - .parquet → application/vnd.apache.parquet
        - .csv → text/csv
        - .json → application/json
        - .txt → text/plain
        - others → application/octet-stream
      operationId: downloadExport
      parameters:
        - name: filename
          in: path
          required: true
          description: Name of the file to download
          schema:
            type: string
      responses:
        '200':
          description: File downloaded successfully
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
            text/csv:
              schema:
                type: string
                format: binary
            application/json:
              schema:
                type: string
                format: binary
            text/plain:
              schema:
                type: string
                format: binary
          headers:
            Content-Disposition:
              description: Suggests filename for download
              schema:
                type: string
              example: 'attachment; filename="results.csv"'
        '400':
          description: Bad request - root not configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - path traversal attempt detected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Exports
      summary: Delete export file or directory
      description: |
        Deletes a file or directory from the exports directory.

        If the target is a directory, it will be recursively deleted.
      operationId: deleteExport
      parameters:
        - name: filename
          in: path
          required: true
          description: Name of the file or directory to delete
          schema:
            type: string
      responses:
        '200':
          description: File or directory deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteResponse'
              example:
                message: "file(s) deleted successfully"
                path: "results.csv"
        '400':
          description: Bad request - root not configured or filename missing
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - path traversal attempt detected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error (e.g., permission denied, directory not empty)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    FileAttribute:
      type: object
      description: Metadata about a file in the directory listing
      properties:
        filename:
          type: string
          description: Name of the file
        path:
          type: string
          description: Relative path from the root directory
        size:
          type: integer
          format: int64
          description: File size in bytes
        sizePretty:
          type: string
          description: Human-readable file size (e.g., "1.0 KiB")
        lastModified:
          type: integer
          format: int64
          description: Unix timestamp of last modification in milliseconds
      required:
        - filename
        - path
        - size
        - sizePretty
        - lastModified

    FileListItem:
      type: object
      description: A file or directory entry in the list response
      properties:
        type:
          type: string
          enum:
            - file
            - directory
          description: Type of the entry
        id:
          type: string
          description: Unique identifier (filename)
        attributes:
          $ref: '#/components/schemas/FileAttribute'
      required:
        - type
        - id
        - attributes

    PaginationInfo:
      type: object
      description: Pagination information for cursor-based pagination
      properties:
        limit:
          type: integer
          description: The number of files returned in this page
        cursor:
          type: string
          description: Cursor value to use for fetching the next page. Only present if there are more results available.
      required:
        - limit

    FileListMeta:
      type: object
      description: Metadata about the file list response
      properties:
        totalFiles:
          type: integer
          description: Total number of files and directories in the listing
        page:
          $ref: '#/components/schemas/PaginationInfo'
          description: Pagination information
      required:
        - totalFiles
        - page

    FileListResponse:
      type: object
      description: Response containing a list of files in a directory
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/FileListItem'
          description: Array of files and directories
        meta:
          $ref: '#/components/schemas/FileListMeta'
      required:
        - data
        - meta

    UploadedFileAttribute:
      type: object
      description: Metadata about an uploaded file
      properties:
        filename:
          type: string
          description: Name of the uploaded file
        status:
          type: string
          enum:
            - uploaded
            - failed
          description: Upload status
        error:
          type: string
          description: Error message if upload failed
      required:
        - filename
        - status

    UploadedFileItem:
      type: object
      description: Result of uploading a single file
      properties:
        type:
          type: string
          enum:
            - file
          description: Type of the entry
        id:
          type: string
          description: Unique identifier (filename)
        attributes:
          $ref: '#/components/schemas/UploadedFileAttribute'
      required:
        - type
        - id
        - attributes

    FileUploadMeta:
      type: object
      description: Metadata about the upload response
      properties:
        totalFiles:
          type: integer
          description: Total number of files processed
      required:
        - totalFiles

    FileUploadResponse:
      type: object
      description: Response containing results of file upload(s)
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/UploadedFileItem'
          description: Array of upload results
        meta:
          $ref: '#/components/schemas/FileUploadMeta'
      required:
        - data
        - meta

    DeleteResponse:
      type: object
      description: Response after deleting a file or directory
      properties:
        message:
          type: string
          description: Confirmation message
        path:
          type: string
          description: Path of the deleted file or directory
      required:
        - message
        - path

    ErrorResponse:
      type: object
      description: Standard error response
      properties:
        status:
          type: integer
          description: HTTP status code
        title:
          type: string
          description: Error title
        detail:
          type: string
          description: Detailed error description
      required:
        - status
        - title
        - detail

  securitySchemes:
    BasicAuth:
      type: http
      scheme: basic
      description: HTTP Basic Authentication
    ApiKeyAuth:
      type: apiKey
      in: header
      name: Authorization
      description: Bearer token authentication

security:
  - BasicAuth: [ ]
  - ApiKeyAuth: [ ]
  - { }

x-footer: |
  For more information about QuestDB, visit https://questdb.io
  Documentation: https://questdb.io/docs/
  GitHub: https://github.com/questdb/questdb
